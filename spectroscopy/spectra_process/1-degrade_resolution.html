<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>降低分辨率 | 天文 wiki 知识库</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="shortcut icon" href="/Astro/favicon.ico">
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/Astro/assets/css/0.styles.8594a18f.css" as="style"><link rel="preload" href="/Astro/assets/js/app.2824fc65.js" as="script"><link rel="preload" href="/Astro/assets/js/2.a0d0d233.js" as="script"><link rel="preload" href="/Astro/assets/js/3.90804e27.js" as="script"><link rel="prefetch" href="/Astro/assets/js/10.0d665c34.js"><link rel="prefetch" href="/Astro/assets/js/11.1f5b658e.js"><link rel="prefetch" href="/Astro/assets/js/12.c11a373a.js"><link rel="prefetch" href="/Astro/assets/js/13.cc284190.js"><link rel="prefetch" href="/Astro/assets/js/4.8b83f7d2.js"><link rel="prefetch" href="/Astro/assets/js/5.c07d27fc.js"><link rel="prefetch" href="/Astro/assets/js/6.ac50a42e.js"><link rel="prefetch" href="/Astro/assets/js/7.0b13d5d3.js"><link rel="prefetch" href="/Astro/assets/js/8.96155048.js"><link rel="prefetch" href="/Astro/assets/js/9.a7b0346d.js">
    <link rel="stylesheet" href="/Astro/assets/css/0.styles.8594a18f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Astro/" class="home-link router-link-active"><!----> <span class="site-name">天文 wiki 知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Astro/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Astro/intro/" class="nav-link">
  介绍
</a></div><div class="nav-item"><a href="/Astro/learn/" class="nav-link">
  学习路线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="光谱学" class="dropdown-title"><span class="title">光谱学</span> <span class="arrow down"></span></button> <button type="button" aria-label="光谱学" class="mobile-dropdown-title"><span class="title">光谱学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Astro/spectroscopy/concepts/" class="nav-link">
  常见概念
</a></li><li class="dropdown-item"><!----> <a href="/Astro/spectroscopy/spectra_process/" class="nav-link router-link-active">
  光谱处理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/iScottMark/Astro" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Astro/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Astro/intro/" class="nav-link">
  介绍
</a></div><div class="nav-item"><a href="/Astro/learn/" class="nav-link">
  学习路线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="光谱学" class="dropdown-title"><span class="title">光谱学</span> <span class="arrow down"></span></button> <button type="button" aria-label="光谱学" class="mobile-dropdown-title"><span class="title">光谱学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Astro/spectroscopy/concepts/" class="nav-link">
  常见概念
</a></li><li class="dropdown-item"><!----> <a href="/Astro/spectroscopy/spectra_process/" class="nav-link router-link-active">
  光谱处理
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/iScottMark/Astro" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Astro/spectroscopy/spectra_process/" aria-current="page" class="sidebar-link">光谱处理</a></li><li><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html" aria-current="page" class="active sidebar-link">降低分辨率</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#方法" class="sidebar-link">方法</a></li><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#最佳实践" class="sidebar-link">最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#_1-基本操作" class="sidebar-link">① 基本操作</a></li><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#_2-处理-pollux-模型光谱" class="sidebar-link">② 处理 POLLUX 模型光谱</a></li><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#_3-降至-lamost-光谱的低分辨率" class="sidebar-link">③ 降至 LAMOST 光谱的低分辨率</a></li><li class="sidebar-sub-header"><a href="/Astro/spectroscopy/spectra_process/1-degrade_resolution.html#_4-降低不等间隔波长步长的光谱分辨率" class="sidebar-link">④ 降低不等间隔波长步长的光谱分辨率</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="降低分辨率"><a href="#降低分辨率" class="header-anchor">#</a> 降低分辨率</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>『降低分辨率』多用于不同分辨率光谱的比较上，主要是将较高的分辨率光谱（如理论合成光谱）降低至较低的观测光谱分辨率（如 SDSS, LAMOST）。</p> <p>降低分辨率在文章的数据处理部分中多被描述为 &quot;degrade the spectral resolution&quot; 或者 &quot;convolve the spectra using Gaussian Kernel&quot;。</p> <h2 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h2> <p>该步骤实际上就是用一个一维高斯滤波器对一维光谱进行卷积操作，起到模糊平滑的作用。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>笔者在最初操作中，将『降低分辨率』与『下采样』的概念混淆。在与导师的沟通交流中，也了解到有学生在论文中犯过同样的错误。</p></div> <p>『下采样』是对一个序列间隔几个样值采样一次，e.g. <code>[1, 1, 2, 2, 3, 3]</code> 如果间隔 step = 2 进行采样，则新序列为 <code>[1, 2, 3]</code>。</p> <h2 id="最佳实践"><a href="#最佳实践" class="header-anchor">#</a> 最佳实践</h2> <p>在实际的光谱处理中，我们需要『具体问题具体分析』，针对不同的光谱仪器特征，或是科学目的、实验精度等，对光谱进行特定的降低分辨率操作。</p> <p>下面以 4 个例子进行讲解，实验代码均在 Python 3 下运行。</p> <p><strong>笔者对第 ③ 个 LAMOST 的例子进行了详细的代码注解。</strong></p> <h3 id="_1-基本操作"><a href="#_1-基本操作" class="header-anchor">#</a> ① 基本操作</h3> <blockquote><p>详情请参考 <a href="https://lotharschanne.wordpress.com/convolution-of-1d-spectra-with-gaussian-functions/" target="_blank" rel="noopener noreferrer">Convolution of 1d-spectra with Gaussian functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>convolution <span class="token keyword">import</span> Gaussian1DKernel
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>convolution <span class="token keyword">import</span> convolve
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> <span class="token builtin">ascii</span>

spectrum_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Path and name of the file: '</span><span class="token punctuation">)</span>

std <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span>'Standard deviation <span class="token keyword">for</span> the convolution <span class="token keyword">in</span> multiples of the\
 increment<span class="token punctuation">:</span> '<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Spektrum einlesen</span>
spectrum <span class="token operator">=</span> <span class="token builtin">ascii</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span>spectrum_name<span class="token punctuation">,</span> guess<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment">#   Convolve using astropy.convolution</span>
kernel <span class="token operator">=</span> Gaussian1DKernel<span class="token punctuation">(</span>stddev<span class="token operator">=</span>std<span class="token punctuation">)</span>
convoluted <span class="token operator">=</span> convolve<span class="token punctuation">(</span>spectrum<span class="token punctuation">[</span><span class="token string">'FLUX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> normalize_kernel<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                      boundary<span class="token operator">=</span><span class="token string">'extend'</span><span class="token punctuation">)</span>

name <span class="token operator">=</span> spectrum_name<span class="token operator">+</span><span class="token string">'_convolved.dat'</span>

<span class="token comment"># Graphics</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Spectrum '</span><span class="token operator">+</span>spectrum_name<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>spectrum<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> spectrum<span class="token punctuation">[</span><span class="token string">'FLUX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Wavelength in Angstrom'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'relative Flux'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>spectrum<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> convoluted<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Wavelength in Angstrom'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'relative Flux'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment"># saving graphics</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>name<span class="token operator">+</span><span class="token string">'.pdf'</span><span class="token punctuation">)</span>

<span class="token comment"># Saving of convolved</span>
<span class="token builtin">ascii</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">[</span>spectrum<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> convoluted<span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> overwrite<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">,</span> <span class="token string">'FLUX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'tab'</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/Astro/assets/img/template_convolved.667e533f.png" alt=""></p> <h3 id="_2-处理-pollux-模型光谱"><a href="#_2-处理-pollux-模型光谱" class="header-anchor">#</a> ② 处理 POLLUX 模型光谱</h3> <blockquote><p>详情请参考 <a href="https://lotharschanne.wordpress.com/processing-of-pollux-model-spectra/" target="_blank" rel="noopener noreferrer">Processing POLLUX model spectra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>POLLUX 是一个高分辨率的理论合成光谱库</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>convolution <span class="token keyword">import</span> Gaussian1DKernel
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>convolution <span class="token keyword">import</span> convolve
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> <span class="token builtin">ascii</span>

<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'path and name of the file: '</span><span class="token punctuation">)</span>
lambda_min <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input of the start wavelength in the spectrum: '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
deltalambda <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input of the step in the spectrum: '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
std <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span>'Standard deviation <span class="token keyword">for</span> the convolution <span class="token keyword">in</span> multiples of the\
 increment<span class="token punctuation">:</span> '<span class="token punctuation">)</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_fwf<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">,</span> <span class="token string">'AFLUX'</span><span class="token punctuation">,</span> <span class="token string">'NFLUX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

wl_li <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Begin of Wavelength range: '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
wl_re <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'End of Wavelength range: '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ind_li <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wl_li<span class="token operator">-</span>lambda_min<span class="token punctuation">)</span> <span class="token operator">/</span> deltalambda<span class="token punctuation">)</span>
ind_re <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wl_re<span class="token operator">-</span>lambda_min<span class="token punctuation">)</span> <span class="token operator">/</span> deltalambda<span class="token punctuation">)</span>
bereich <span class="token operator">=</span> table<span class="token punctuation">[</span>ind_li<span class="token punctuation">:</span>ind_re<span class="token punctuation">]</span>

<span class="token comment">#   Convolve using astropy.convolution</span>
kernel <span class="token operator">=</span> Gaussian1DKernel<span class="token punctuation">(</span>stddev<span class="token operator">=</span>std<span class="token punctuation">)</span>
con <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>bereich<span class="token punctuation">[</span><span class="token string">'NFLUX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
convoluted <span class="token operator">=</span> convolve<span class="token punctuation">(</span>con<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> normalize_kernel<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                      boundary<span class="token operator">=</span><span class="token string">'extend'</span><span class="token punctuation">)</span>

<span class="token comment"># Graphics</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'seaborn-whitegrid'</span><span class="token punctuation">)</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>set_size_inches<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Wavelength [Angstrom]'</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Spectrum '</span><span class="token operator">+</span><span class="token builtin">file</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>table<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> table<span class="token punctuation">[</span><span class="token string">'NFLUX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>bereich<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> bereich<span class="token punctuation">[</span><span class="token string">'NFLUX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>bereich<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> convoluted<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">+</span><span class="token string">'.pdf'</span><span class="token punctuation">)</span>

<span class="token comment"># Save convoluted spectrum, NFLUX now as FLUX</span>
convol_file <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>bereich<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> convoluted<span class="token punctuation">,</span>
                           columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">,</span> <span class="token string">'NFLUX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
name <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'.spec'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'_convolved.dat'</span>
<span class="token builtin">ascii</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">[</span>bereich<span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> convoluted<span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> overwrite<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
            names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'WAVE'</span><span class="token punctuation">,</span> <span class="token string">'FLUX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'tab'</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/Astro/assets/img/deneb_spec_convolved.55bfaec6.png" alt=""></p> <h3 id="_3-降至-lamost-光谱的低分辨率"><a href="#_3-降至-lamost-光谱的低分辨率" class="header-anchor">#</a> ③ 降至 LAMOST 光谱的低分辨率</h3> <blockquote><p>实验中用到的分辨率为 50,000 的光谱 ​<a href="https://gitee.com/iScottMark/Astro/raw/master/docs/spectroscopy/spectra_process/ap00t5777g44377k1odfnew_50000.spec" target="_blank" rel="noopener noreferrer">📗 下载链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>signal
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>ndimage <span class="token keyword">import</span> gaussian_filter1d
<span class="token keyword">from</span> scipy <span class="token keyword">import</span> interpolate
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt


<span class="token keyword">def</span> <span class="token function">conv</span><span class="token punctuation">(</span>origin_flux<span class="token punctuation">,</span> old_resolution<span class="token punctuation">,</span> new_resolution<span class="token punctuation">,</span> step<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; degrade spectral resolution in LAMOST scale
    :param origin_flux: the original flux of high spectral resolution
    :param old_resolution: high resolution
    :param new_resolution: low resolution
    :param step: the step of original spectra wavelength
    :return: the degraded flux of low resolution
    &quot;&quot;&quot;</span>
    <span class="token comment"># 5000 angstrom is the approximate central wavelength of LAMOST</span>
    <span class="token comment"># 2.355 is the constant of the transformation from FWHM (i.e. delta lambda) to sigma</span>
    sigma <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">.</span> <span class="token operator">/</span> new_resolution<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">.</span> <span class="token operator">/</span> old_resolution<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2.355</span> <span class="token operator">*</span> step<span class="token punctuation">)</span>
    <span class="token comment"># use gaussian kernel to degrade the spectra</span>
    degraded_flux <span class="token operator">=</span> gaussian_filter1d<span class="token punctuation">(</span>origin_flux<span class="token punctuation">,</span> sigma<span class="token punctuation">)</span>
    <span class="token keyword">return</span> degraded_flux


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取原始光谱文件</span>
    data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'ap00t5777g44377k1odfnew_50000.spec'</span><span class="token punctuation">)</span>
    wave_01 <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 原始波长的步长间隔为 0.1 angstrom</span>
    flux_01 <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token comment"># 对光谱进行插值，分别将流量插值到波长的步长间隔为 0.01 和 0.005</span>
    <span class="token comment"># 同时，为了方便展示，只截取 [4800, 6800] 这一段波长</span>
    wave_001 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">4800</span><span class="token punctuation">,</span> <span class="token number">6800</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>
    flux_001 <span class="token operator">=</span> interpolate<span class="token punctuation">.</span>interp1d<span class="token punctuation">(</span>wave_01<span class="token punctuation">,</span> flux_01<span class="token punctuation">)</span><span class="token punctuation">(</span>wave_001<span class="token punctuation">)</span>
    wave_0005 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">4800</span><span class="token punctuation">,</span> <span class="token number">6799.99</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">)</span>
    flux_0005 <span class="token operator">=</span> interpolate<span class="token punctuation">.</span>interp1d<span class="token punctuation">(</span>wave_01<span class="token punctuation">,</span> flux_01<span class="token punctuation">)</span><span class="token punctuation">(</span>wave_0005<span class="token punctuation">)</span>

    <span class="token comment"># 分别对步长为 0.01 和 0.005 的流量降低分辨率</span>
    flux_001_degrade <span class="token operator">=</span> conv<span class="token punctuation">(</span>origin_flux<span class="token operator">=</span>flux_001<span class="token punctuation">,</span> old_resolution<span class="token operator">=</span><span class="token number">50000</span><span class="token punctuation">,</span>
                            new_resolution<span class="token operator">=</span><span class="token number">7500</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>
    flux_0005_degrade <span class="token operator">=</span> conv<span class="token punctuation">(</span>origin_flux<span class="token operator">=</span>flux_0005<span class="token punctuation">,</span> old_resolution<span class="token operator">=</span><span class="token number">50000</span><span class="token punctuation">,</span>
                             new_resolution<span class="token operator">=</span><span class="token number">7500</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">0.005</span><span class="token punctuation">)</span>

    <span class="token comment"># 画图</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>wave_01<span class="token punctuation">,</span> flux_01<span class="token punctuation">,</span> <span class="token string">'b-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'step01'</span><span class="token punctuation">)</span>
    <span class="token comment"># + 40 偏移，否则步长为 0.01 的绿线会被步长为 0.005 的红线完全覆盖，看不出来</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>wave_001 <span class="token operator">+</span> <span class="token number">40</span><span class="token punctuation">,</span> flux_001_degrade<span class="token punctuation">,</span> <span class="token string">'g-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'step001'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>wave_0005<span class="token punctuation">,</span> flux_0005_degrade<span class="token punctuation">,</span> <span class="token string">'r--'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'step0005'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/Astro/assets/img/degrade_lamost.ba23401c.png" alt=""></p> <h3 id="_4-降低不等间隔波长步长的光谱分辨率"><a href="#_4-降低不等间隔波长步长的光谱分辨率" class="header-anchor">#</a> ④ 降低不等间隔波长步长的光谱分辨率</h3> <blockquote><p>详情请参考 <a href="https://github.com/jason-neal/convolve_spectrum" target="_blank" rel="noopener noreferrer">convolve_spectra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新于:</span> <span class="time">6/30/2021, 10:41:18 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Astro/spectroscopy/spectra_process/" class="prev router-link-active">
        光谱处理
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/Astro/assets/js/app.2824fc65.js" defer></script><script src="/Astro/assets/js/2.a0d0d233.js" defer></script><script src="/Astro/assets/js/3.90804e27.js" defer></script>
  </body>
</html>
